<div class="container">
    <div class="card mt-3">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <label class="form-label me-3 text-nowrap" style="width: 150px;">Historico de Visitas</label>
                        <div class="flex-grow-1">
                            <ng-select [items]="visitors" [bindLabel]="'name'" placeholder=""
                                [(ngModel)]="selectedVisitorId" (change)="onVisitorSelect($event)" [clearable]="true">
                                <ng-option [value]="null">Ninguno</ng-option>
                                <ng-template ng-option-tmp let-item="item">
                                    {{item.name}} {{item.last_name}} - {{item.document}}
                                </ng-template>

                                <ng-template ng-label-tmp let-item="item">
                                    {{item.name}} {{item.last_name}} - {{item.document}}
                                </ng-template>
                            </ng-select>
                        </div>
                    </div>
                </div>
            </div>
            <form [formGroup]="visitorForm" (ngSubmit)="onSubmit()">
                <div class="container">
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title mb-0 mb-3">Editar Acceso del Visitante</h5>
                            <form [formGroup]="visitorForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="firstName" class="form-label me-3 text-nowrap"
                                                style="width: 150px;">Nombre</label>
                                            <div class="flex-grow-1">
                                                <input type="text" class="form-control" id="firstName"
                                                    formControlName="firstName"
                                                    [class.is-valid]="visitorForm.get('firstName')?.valid && visitorForm.get('firstName')?.touched"
                                                    [class.is-invalid]="visitorForm.get('firstName')?.invalid && visitorForm.get('firstName')?.touched">
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('firstName')?.errors && visitorForm.get('firstName')?.touched">
                                                    <div *ngIf="visitorForm.get('firstName')?.errors?.['required']">El nombre es
                                                        requerido.</div>
                                                    <div *ngIf="visitorForm.get('firstName')?.errors?.['maxlength']">El nombre
                                                        no puede exceder 45 caracteres.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="lastName" class="form-label me-3 text-nowrap"
                                                style="width: 150px;">Apellido</label>
                                            <div class="flex-grow-1">
                                                <input type="text" class="form-control" id="lastName" formControlName="lastName"
                                                    [class.is-valid]="visitorForm.get('lastName')?.valid && visitorForm.get('lastName')?.touched"
                                                    [class.is-invalid]="visitorForm.get('lastName')?.invalid && visitorForm.get('lastName')?.touched">
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('lastName')?.errors && visitorForm.get('lastName')?.touched">
                                                    <div *ngIf="visitorForm.get('lastName')?.errors?.['required']">El apellido
                                                        es requerido.</div>
                                                    <div *ngIf="visitorForm.get('lastName')?.errors?.['maxlength']">El apellido
                                                        no puede exceder 45 caracteres.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="documentType" class="form-label me-3 text-nowrap"
                                                style="width: 150px;">Tipo Documento</label>
                                            <div class="flex-grow-1">
                                                <select id="documentType" class="form-select" formControlName="documentType"
                                                    [class.is-valid]="visitorForm.get('documentType')?.valid && visitorForm.get('documentType')?.touched"
                                                    [class.is-invalid]="visitorForm.get('documentType')?.invalid && visitorForm.get('documentType')?.touched"
                                                    required>
                                                    <option value="DNI">DNI</option>
                                                    <option value="PASSPORT">Pasaporte</option>
                                                    <option value="CUIT">CUIT</option>
                                                </select>
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('documentType')?.invalid && visitorForm.get('documentType')?.touched">
                                                    Por favor seleccione un tipo de documento.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="document" class="form-label me-3 text-nowrap"
                                                style="width: 150px;">Documento</label>
                                            <div class="flex-grow-1">
                                                <input type="text" class="form-control" id="document" formControlName="document"
                                                    [class.is-valid]="visitorForm.get('document')?.valid && visitorForm.get('document')?.touched"
                                                    [class.is-invalid]="visitorForm.get('document')?.invalid && visitorForm.get('document')?.touched">
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('document')?.errors && visitorForm.get('document')?.touched">
                                                    <div *ngIf="visitorForm.get('document')?.errors?.['required']">El documento
                                                        es requerido.</div>
                                                    <div *ngIf="visitorForm.get('document')?.errors?.['invalidDniFormat']">El
                                                        documento no tiene el formato requerido (Debe tener 7 u 8 caracteres).
                                                    </div>
                                                    <div *ngIf="visitorForm.get('document')?.errors?.['invalidPassportFormat']">
                                                        El pasaporte no tiene el formato requerido (Ingresar letras, números,
                                                        longitud entre 6 y 9 caracteres).</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="authorizedType" class="form-label me-3 text-nowrap"
                                                style="width: 150px;">Tipo Autorizado</label>
                                            <div class="flex-grow-1">
                                                <select id="authorizedType" class="form-select" formControlName="authorizedType"
                                                    [class.is-valid]="visitorForm.get('authorizedType')?.valid && visitorForm.get('authorizedType')?.touched"
                                                    [class.is-invalid]="visitorForm.get('authorizedType')?.invalid && visitorForm.get('authorizedType')?.touched"
                                                    required>
                                                    <option *ngFor="let type of usersType" [value]="type.description">
                                                        {{ type.description }}
                                                    </option>
                                                </select>
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('authorizedType')?.errors?.['required'] && visitorForm.get('authorizedType')?.touched">
                                                    Por favor seleccione un tipo de autorización.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <label for="email" class="form-label me-3 text-nowrap" style="width: 150px;">Email
                                                (Opcional)</label>
                                            <div class="flex-grow-1">
                                                <input type="email" class="form-control" id="email" formControlName="email"
                                                    [class.is-invalid]="visitorForm.get('email')?.errors?.['email'] && visitorForm.get('email')?.touched">
                                                <div class="invalid-feedback"
                                                    *ngIf="visitorForm.get('email')?.errors?.['email'] && visitorForm.get('email')?.touched">
                                                    Por favor, ingrese un email válido
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
        
                <app-access-time-range-visitors-registration></app-access-time-range-visitors-registration>
                <div class="row mt-3">
                    <div class="col-12 d-flex justify-content-end">

                        <button type="submit" class="btn btn-secondary btn-sm me-3" style="margin-bottom: 2px" (click)="cancelar()">
                        Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary btn-sm" style="margin-bottom: 2px"
                            [disabled]="!(visitorForm.get('document')?.valid && visitorForm.get('firstName')?.valid)">
                            Guardar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>